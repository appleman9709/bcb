#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–≤–µ—Ç–∞–º–∏ –∏–∑ SQL —Ñ–∞–π–ª–∞
"""

import os
from dotenv import load_dotenv
from supabase import create_client, Client

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
supabase: Client = create_client(os.getenv('SUPABASE_URL'), os.getenv('SUPABASE_KEY'))

def populate_tips_from_sql():
    """–ó–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–æ–≤–µ—Ç–∞–º–∏ –∏–∑ SQL —Ñ–∞–π–ª–∞"""
    print("üöÄ –ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–æ–≤–µ—Ç–∞–º–∏...")
    
    try:
        # –ß–∏—Ç–∞–µ–º SQL —Ñ–∞–π–ª
        with open('tips_database.sql', 'r', encoding='utf-8') as file:
            sql_content = file.read()
        
        # –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        sql_queries = [query.strip() for query in sql_content.split(';') if query.strip() and not query.strip().startswith('--')]
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
        for i, query in enumerate(sql_queries):
            if query.upper().startswith('INSERT INTO tips'):
                try:
                    # –î–ª—è INSERT –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º Supabase API
                    if 'VALUES' in query.upper():
                        # –ü–∞—Ä—Å–∏–º INSERT –∑–∞–ø—Ä–æ—Å
                        values_start = query.upper().find('VALUES') + 6
                        values_part = query[values_start:].strip()
                        
                        # –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
                        if 'age_months' in query and 'content' in query:
                            # –≠—Ç–æ INSERT –∑–∞–ø—Ä–æ—Å —Å –¥–∞–Ω–Ω—ã–º–∏
                            print(f"üìù –í—ã–ø–æ–ª–Ω—è–µ–º INSERT –∑–∞–ø—Ä–æ—Å {i+1}...")
                            # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞
                            # –ü–æ–∫–∞ —á—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–æ–∂–Ω—ã–µ INSERT –∑–∞–ø—Ä–æ—Å—ã
                        else:
                            print(f"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å {i+1} (–Ω–µ INSERT INTO tips)")
                    else:
                        print(f"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å {i+1} (–Ω–µ VALUES)")
                except Exception as e:
                    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ {i+1}: {e}")
            else:
                print(f"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å {i+1} (–Ω–µ INSERT INTO tips)")
        
        print("‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ SQL —Ñ–∞–π–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
        print("üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –≤—Ä—É—á–Ω—É—é –≤ Supabase Dashboard")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ SQL —Ñ–∞–π–ª–∞: {e}")

def add_sample_tips():
    """–î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤ —Å–æ–≤–µ—Ç–æ–≤"""
    print("üöÄ –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä—ã —Å–æ–≤–µ—Ç–æ–≤...")
    
    sample_tips = [
        {
            'age_months': 0,
            'content': 'üçº –ö–æ—Ä–º–∏—Ç–µ –º–∞–ª—ã—à–∞ –∫–∞–∂–¥—ã–µ 2-3 —á–∞—Å–∞, –¥–∞–∂–µ –Ω–æ—á—å—é. –ù–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ –µ–¥—è—Ç —á–∞—Å—Ç–æ –∏ –ø–æ–Ω–µ–º–Ω–æ–≥—É.',
            'category': '–ö–æ—Ä–º–ª–µ–Ω–∏–µ'
        },
        {
            'age_months': 0,
            'content': 'üí§ –°–æ–Ω –Ω–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 16-18 —á–∞—Å–æ–≤ –≤ —Å—É—Ç–∫–∏. –ù–µ –±–µ—Å–ø–æ–∫–æ–π—Ç–µ—Å—å, –µ—Å–ª–∏ –º–∞–ª—ã—à —Å–ø–∏—Ç –º–Ω–æ–≥–æ.',
            'category': '–°–æ–Ω'
        },
        {
            'age_months': 1,
            'content': 'üòä –ú–∞–ª—ã—à –Ω–∞—á–∏–Ω–∞–µ—Ç —É–ª—ã–±–∞—Ç—å—Å—è! –≠—Ç–æ –≤–∞–∂–Ω—ã–π —ç—Ç–∞–ø —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.',
            'category': '–†–∞–∑–≤–∏—Ç–∏–µ'
        },
        {
            'age_months': 2,
            'content': 'ü§≤ –ú–∞–ª—ã—à –Ω–∞—á–∏–Ω–∞–µ—Ç —Ö–≤–∞—Ç–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã. –î–∞–≤–∞–π—Ç–µ –µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–≥—Ä—É—à–∫–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –º–æ—Ç–æ—Ä–∏–∫–∏.',
            'category': '–†–∞–∑–≤–∏—Ç–∏–µ'
        },
        {
            'age_months': 3,
            'content': 'üîÑ –ú–∞–ª—ã—à –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Å –∂–∏–≤–æ—Ç–∞ –Ω–∞ —Å–ø–∏–Ω—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–∞.',
            'category': '–†–∞–∑–≤–∏—Ç–∏–µ'
        }
    ]
    
    try:
        for tip in sample_tips:
            result = supabase.table('tips').insert(tip).execute()
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å–æ–≤–µ—Ç –¥–ª—è {tip['age_months']} –º–µ—Å—è—Ü–µ–≤: {tip['category']}")
        
        print(f"\nüéâ –£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ {len(sample_tips)} –ø—Ä–∏–º–µ—Ä–æ–≤ —Å–æ–≤–µ—Ç–æ–≤!")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        result = supabase.table('tips').select('*').execute()
        print(f"üìä –í—Å–µ–≥–æ —Å–æ–≤–µ—Ç–æ–≤ –≤ –±–∞–∑–µ: {len(result.data)}")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ —Å–æ–≤–µ—Ç–æ–≤: {e}")

if __name__ == "__main__":
    print("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:")
    print("1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∏–∑ SQL —Ñ–∞–π–ª–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –≤—Ä—É—á–Ω—É—é)")
    print("2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å–æ–≤–µ—Ç–æ–≤")
    
    choice = input("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1 –∏–ª–∏ 2): ").strip()
    
    if choice == "1":
        populate_tips_from_sql()
    elif choice == "2":
        add_sample_tips()
    else:
        print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä")
